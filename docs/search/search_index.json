{"config":{"lang":["pt"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Vinti4Net Legacy PHP SDK","text":"<p>Bem-vindo \u00e0 documenta\u00e7\u00e3o oficial da biblioteca Vinti4Net Legacy PHP, uma solu\u00e7\u00e3o moderna e otimizada para integra\u00e7\u00e3o com o SISP / Vinti4Net (Cabo Verde) \u2014 totalmente compat\u00edvel com aplica\u00e7\u00f5es legacy, incluindo PHP 5.6+.</p> <p>Esta biblioteca fornece uma interface simples e segura para:</p> <ul> <li>\ud83d\udcb3 Pagamentos (Purchase 3DS)</li> <li>\ud83e\uddfe Pagamento de servi\u00e7os (Entity/Reference)</li> <li>\ud83d\udd04 Recargas</li> <li>\u21a9\ufe0f Reembolsos (Refund)</li> <li>\ud83d\udcb1 Suporte a DCC (Dynamic Currency Conversion)</li> <li>\ud83d\udee1\ufe0f Fingerprints SHA512</li> <li>\ud83e\udde9 Normaliza\u00e7\u00e3o autom\u00e1tica de billing e dados 3DS</li> </ul>"},{"location":"#caracteristicas","title":"\u2728 Caracter\u00edsticas","text":"<ul> <li>Compat\u00edvel com PHP 5.6 at\u00e9 8.x</li> <li>API moderna baseada em method chaining</li> <li>Valida\u00e7\u00f5es fortes e normaliza\u00e7\u00e3o de dados</li> <li>Suporte completo aos fluxos do SISP</li> <li>Processamento seguro de respostas e fingerprints</li> <li>Independente de frameworks</li> </ul>"},{"location":"#conteudo","title":"\ud83d\udcda Conte\u00fado","text":"<ul> <li>Guia R\u00e1pido: vis\u00e3o pr\u00e1tica para come\u00e7ar r\u00e1pido  </li> <li>Documenta\u00e7\u00e3o Avan\u00e7ada: explica\u00e7\u00f5es detalhadas sobre 3DS, DCC, fingerprints e integra\u00e7\u00f5es  </li> <li>API Reference: descri\u00e7\u00e3o t\u00e9cnica dos m\u00e9todos  </li> <li>Exemplos completos: pagamentos, servi\u00e7os, recargas e refunds  </li> </ul>"},{"location":"#instalacao","title":"\ud83d\udce6 Instala\u00e7\u00e3o","text":"<p>Via Composer:</p> <pre><code>composer require erilshk/vinti4net-legacy\n</code></pre> <p>Ou inclus\u00e3o manual da classe (para projetos 100% legados).</p>"},{"location":"#licenca","title":"\ud83d\udcdd Licen\u00e7a","text":"<p>MIT \u2014 uso livre e comercial.</p>"},{"location":"#sobre-o-projeto","title":"\ud83d\udc68\u200d\ud83d\udcbb Sobre o Projeto","text":"<p>Criado e mantido por Erilando TS Carvalho, com foco em estabilidade, compatibilidade e facilidade de integra\u00e7\u00e3o.</p>"},{"location":"advanced/","title":"\ud83d\udcd8 Documenta\u00e7\u00e3o Avan\u00e7ada","text":"<p>Esta sec\u00e7\u00e3o cobre:</p> <ol> <li>\ud83d\udd10 Arquitetura interna</li> <li>\ud83d\udd04 Ciclo completo de pagamento (Purchase / Service / Recharge / Refund)</li> <li>\ud83d\udee1\ufe0f Fingerprints (Request &amp; Response)</li> <li>\ud83e\udded Flow de 3D Secure + Campos 3DS</li> <li>\ud83c\udf0d DCC \u2014 Dynamic Currency Conversion</li> <li>\ud83e\udde9 Normaliza\u00e7\u00e3o avan\u00e7ada de Billing</li> <li>\u26a0\ufe0f Valida\u00e7\u00f5es do SISP</li> <li>\ud83e\uddea Boas pr\u00e1ticas em produ\u00e7\u00e3o</li> <li>\ud83c\udfd7\ufe0f Modelos de resposta</li> <li>\ud83d\udee0\ufe0f Troubleshooting</li> </ol>"},{"location":"advanced/#1-arquitetura-interna","title":"1. \ud83d\udd10 Arquitetura Interna","text":"<p>A classe <code>Vinti4NetLegacy</code> foi constru\u00edda com tr\u00eas pilares:</p>"},{"location":"advanced/#1-pre-processamento-do-pedido","title":"1) Pr\u00e9-processamento do pedido","text":"<ul> <li>Convers\u00e3o de moeda</li> <li>Gera\u00e7\u00e3o de merchantRef &amp; merchantSession</li> <li>Normaliza\u00e7\u00e3o de billing</li> <li>Valida\u00e7\u00e3o de campos obrigat\u00f3rios</li> </ul>"},{"location":"advanced/#2-assinatura-de-seguranca","title":"2) Assinatura de seguran\u00e7a","text":"<ul> <li>Fingerprint SHA512 obrigat\u00f3rio pelo SISP</li> <li>Codifica\u00e7\u00e3o Base64</li> <li>Fluxo diferente para payment e refund</li> </ul>"},{"location":"advanced/#3-pos-processamento-da-resposta","title":"3) P\u00f3s-processamento da resposta","text":"<ul> <li>Valida\u00e7\u00e3o de fingerprint</li> <li>Interpreta\u00e7\u00e3o do messageType</li> <li>Extra\u00e7\u00e3o opcional de dados DCC</li> <li>Normaliza\u00e7\u00e3o da resposta para o cliente</li> </ul>"},{"location":"advanced/#2-ciclo-completo-de-pagamento","title":"2. \ud83d\udd04 Ciclo Completo de Pagamento","text":""},{"location":"advanced/#fluxo-tipico-purchase-3ds","title":"Fluxo t\u00edpico (Purchase 3DS)","text":"<pre><code>Comerciante \u2192 SDK \u2192 SISP  \u2192 Middleware \u2192 SDK \u2192 Comerciante\n</code></pre> <ol> <li>Cliente inicia o pagamento</li> <li>SDK gera auto-submit</li> <li>Cliente autentica no Middleware (3DS)</li> <li>SISP notifica seu endpoint com POST</li> <li>SDK valida a resposta</li> <li>Resultado final retorna ao sistema</li> </ol>"},{"location":"advanced/#3-fingerprints-em-detalhe","title":"3. \ud83d\udee1\ufe0f Fingerprints em Detalhe","text":"<p>O SISP usa fingerprints SHA512 combinando:</p> <ul> <li>POSAuthCode (hash interno)</li> <li>Campos cr\u00edticos da requisi\u00e7\u00e3o/retorno</li> <li>Convers\u00e3o especial do valor (amount \u00d7 1000)</li> <li>Codifica\u00e7\u00e3o final Base64</li> </ul>"},{"location":"advanced/#31-fingerprint-do-request","title":"3.1 Fingerprint do Request","text":"<p>O m\u00e9todo interno:</p> <pre><code>fingerprintRequest(array $data, $type = 'payment')\n</code></pre>"},{"location":"advanced/#para-pagamentos","title":"Para pagamentos:","text":"<pre><code>FP = BASE64(\n    SHA512(\n        base64(SHA512(POS_AUTH))\n        + timeStamp\n        + amountLong\n        + merchantRef\n        + merchantSession\n        + posID\n        + currency\n        + transactionCode\n        + entityCode\n        + referenceNumber\n    )\n)\n</code></pre>"},{"location":"advanced/#observacoes","title":"Observa\u00e7\u00f5es:","text":"<ul> <li>amountLong = <code>amount * 1000</code> (regra oficial do SISP)</li> <li>Campos de entidade s\u00f3 s\u00e3o inclu\u00eddos se n\u00e3o forem vazios</li> <li>Ordem dos campos \u00e9 fixa e obrigat\u00f3ria</li> </ul>"},{"location":"advanced/#32-fingerprint-da-resposta","title":"3.2 Fingerprint da Resposta","text":"<p>O m\u00e9todo:</p> <pre><code>fingerprintResponse(array $post)\n</code></pre> <p>Para PURCHASE:</p> <pre><code>FP = BASE64(\n    SHA512(\n        base64(SHA512(POS_AUTH))\n        + messageType\n        + merchantRespCP\n        + merchantRespTid\n        + merchantRespMerchantRef\n        + merchantRespMerchantSession\n        + merchantRespPurchaseAmountLong\n        + merchantRespMessageID\n        + merchantRespPan\n        + merchantResp\n        + merchantRespTimeStamp\n        + merchantRespReferenceNumber\n        + merchantRespEntityCode\n        + merchantRespClientReceipt\n        + merchantRespAdditionalErrorMessage\n        + merchantRespReloadCode\n    )\n)\n</code></pre>"},{"location":"advanced/#4-3d-secure-campos-suportados","title":"4. \ud83e\udded 3D Secure \u2013 Campos Suportados","text":"<p>O SDK tem integra\u00e7\u00e3o autom\u00e1tica com par\u00e2metros t\u00edpicos de 3DS:</p>"},{"location":"advanced/#campos-derivados","title":"Campos derivados:","text":"Campo Origem Significado chAccAgeInd created_at Idade da conta chAccPwChangeInd updated_at Mudan\u00e7a de password suspiciousAccActivity user.suspicious Indica comportamento suspeito mobilePhone user.phone/user.mobilePhone Normalizado em CC + subscriber workPhone idem <p>Exemplo de input simplificado:</p> <pre><code>[\n    'user' =&gt; [\n        'email' =&gt; 'client@mail.com',\n        'created_at' =&gt; '2020-05-01',\n        'updated_at' =&gt; '2024-01-01',\n        'suspicious' =&gt; false,\n        'phone' =&gt; '+238 9912345'\n    ]\n]\n</code></pre> <p>O SDK transforma isso em um payload 3DS para PurchaseRequest.</p>"},{"location":"advanced/#5-dcc-dynamic-currency-conversion","title":"5. \ud83c\udf0d DCC \u2014 Dynamic Currency Conversion","text":"<p>Se o banco do cliente oferecer DCC, o SISP envia:</p> <pre><code>{\n  \"dcc\": \"Y\",\n  \"dccAmount\": \"23.50\",\n  \"dccCurrency\": \"EUR\",\n  \"dccMarkup\": \"3.1\",\n  \"dccRate\": \"0.00923\"\n}\n</code></pre> <p>O SDK converte automaticamente para:</p> <pre><code>[\n    'enabled' =&gt; true,\n    'amount' =&gt; 23.50,\n    'currency' =&gt; 'EUR',\n    'markup' =&gt; 3.1,\n    'rate' =&gt; 0.00923\n]\n</code></pre>"},{"location":"advanced/#6-normalizacao-avancada-de-billing","title":"6. \ud83e\udde9 Normaliza\u00e7\u00e3o Avan\u00e7ada de Billing","text":"<p>Exemplo de convers\u00e3o autom\u00e1tica de telefone:</p> <p>Entrada:</p> <pre><code>+238 9912345\n</code></pre> <p>Sa\u00edda:</p> <pre><code>[\n    'cc' =&gt; '238',\n    'subscriber' =&gt; '9912345'\n]\n</code></pre> <p>Regras:</p> <ul> <li>Remove caracteres n\u00e3o num\u00e9ricos</li> <li>Tenta detectar c\u00f3digo do pa\u00eds automaticamente</li> <li>Usa fallback DEFAULT: 238 (Cabo Verde)</li> </ul>"},{"location":"advanced/#7-validacoes-do-sisp","title":"7. \u26a0\ufe0f Valida\u00e7\u00f5es do SISP","text":"<p>Para Purchase:</p> Campo Obrigat\u00f3rio Observa\u00e7\u00f5es billAddrCountry \u2714 ISO num\u00e9rico billAddrCity \u2714 \u2014 billAddrLine1 \u2714 Endere\u00e7o billAddrPostCode \u2714 C\u00f3digo postal email \u2714 \u2014 <p>Se faltar, SDK dispara:</p> <pre><code>InvalidArgumentException(\"Campo obrigat\u00f3rio ausente em billing: ...\")\n</code></pre>"},{"location":"advanced/#8-boas-praticas-de-producao","title":"8. \ud83e\uddea Boas Pr\u00e1ticas de Produ\u00e7\u00e3o","text":""},{"location":"advanced/#evite-valores-decimais-no-sisp","title":"Evite valores decimais no SISP","text":"<p>O SISP n\u00e3o lida com floats; o SDK converte, mas recomenda-se evitar:</p> <pre><code>1500.00 \u2192 OK  \n1500.5  \u2192 Pode causar rejei\u00e7\u00e3o\n</code></pre>"},{"location":"advanced/#sempre-valide-fingerprint","title":"Sempre valide fingerprint","text":"<p>Nunca confie apenas no messageType.</p>"},{"location":"advanced/#use-https-no-responseurl","title":"Use HTTPS no responseUrl","text":"<p>\u00c9 obrigat\u00f3rio para certifica\u00e7\u00f5es PCI/3DS.</p>"},{"location":"advanced/#registre-logs-em-caso-de-invalid_fingerprint","title":"Registre logs em caso de INVALID_FINGERPRINT","text":"<p>O SDK j\u00e1 entrega:</p> <pre><code>'debug' =&gt; [\n    'recebido' =&gt; '',\n    'calculado' =&gt; ''\n]\n</code></pre>"},{"location":"advanced/#9-modelo-de-resposta-do-sdk","title":"9. \ud83c\udfd7\ufe0f Modelo de Resposta do SDK","text":"<pre><code>[\n    'success' =&gt; true|false,\n    'status' =&gt; 'SUCCESS|ERROR|CANCELLED|INVALID_FINGERPRINT',\n    'message' =&gt; '...',\n    'data' =&gt; [...],   // Dados brutos $_POST do SISP\n    'dcc' =&gt; [\n        'enabled' =&gt; bool,\n        'amount' =&gt; float|null,\n        'currency' =&gt; string|null,\n        'markup' =&gt; float|null,\n        'rate' =&gt; float|null\n    ],\n    'debug' =&gt; [...],\n    'detail' =&gt; string|null\n]\n</code></pre>"},{"location":"advanced/#10-troubleshooting","title":"10. \ud83d\udee0\ufe0f Troubleshooting","text":""},{"location":"advanced/#fingerprint-invalido","title":"\u274c Fingerprint inv\u00e1lido","text":"<p>Causas comuns:</p> <ul> <li>posAuthCode errado</li> <li>merchantRef/merchantSession modificados</li> <li>amount convertido incorretamente</li> <li>timezone do servidor</li> <li>encoding UTF-8 quebrado</li> </ul>"},{"location":"advanced/#messagetype-correto-mas-status-failed","title":"\u274c messageType correto, mas status FAILED","text":"<p>Motivo:</p> <ul> <li>N\u00e3o confundir messageType (tipo de mensagem) com resultado</li> </ul>"},{"location":"advanced/#dcc-nao-aparece","title":"\u274c DCC n\u00e3o aparece","text":"<p>Motivos:</p> <ul> <li>Banco emissor n\u00e3o oferece DCC</li> <li>Cliente n\u00e3o aceitou convers\u00e3o</li> <li>Transa\u00e7\u00e3o n\u00e3o \u00e9 PURCHASE</li> </ul>"},{"location":"advanced/#only-1-payment-request-must-be-prepared","title":"\u274c \u201cONLY 1 PAYMENT REQUEST MUST BE PREPARED\u201d","text":"<p>O SDK n\u00e3o permite reusar a mesma inst\u00e2ncia para m\u00faltiplas transa\u00e7\u00f5es. Fa\u00e7a:</p> <pre><code>$vinti4 = new Vinti4NetLegacy(...); // nova inst\u00e2ncia\n</code></pre>"},{"location":"api/","title":"Refer\u00eancia da API","text":"<p>Esta p\u00e1gina documenta todos os m\u00e9todos p\u00fablicos da classe Vinti4NetLegacy.</p>"},{"location":"api/#construtor","title":"\ud83d\udd27 Construtor","text":"<pre><code>__construct(string $posID, string $posAuthCode)\n</code></pre> Par\u00e2metro Tipo Descri\u00e7\u00e3o <code>posID</code> string Identificador do POS fornecido pelo SISP <code>posAuthCode</code> string C\u00f3digo de autentica\u00e7\u00e3o POS fornecido pelo SISP"},{"location":"api/#metodos-principais","title":"\ud83d\udfe6 M\u00e9todos Principais","text":""},{"location":"api/#preparepurchasepayment","title":"preparePurchasePayment","text":"<pre><code>preparePurchasePayment(int $amount, array $options = [])\n</code></pre> <p>Prepara um pagamento 3DS.</p>"},{"location":"api/#parametros","title":"Par\u00e2metros:","text":"<ul> <li>amount \u2013 valor em escudos (inteiro)</li> <li>options.user \u2013 dados do cliente para 3DS</li> <li>options.orderId \u2013 opcional</li> <li>options.currency \u2013 padr\u00e3o CVE</li> </ul>"},{"location":"api/#prepareservicepayment","title":"prepareServicePayment","text":"<pre><code>prepareServicePayment(int $amount, string $entity, string $reference)\n</code></pre> <p>Pagamentos de servi\u00e7os.</p>"},{"location":"api/#preparerechargepayment","title":"prepareRechargePayment","text":"<pre><code>prepareRechargePayment(int $amount, string $rechargeCode)\n</code></pre> <p>Fluxo de recargas.</p>"},{"location":"api/#preparerefundpayment","title":"prepareRefundPayment","text":"<pre><code>prepareRefundPayment(string $transactionId, int $amount)\n</code></pre> <p>Fluxo de reembolso (refund).</p>"},{"location":"api/#parametros-opcionais","title":"\ud83d\udd04 Par\u00e2metros opcionais","text":""},{"location":"api/#setrequestparams","title":"setRequestParams","text":"<pre><code>setRequestParams(array $params)\n</code></pre> <p>Permite acrescentar par\u00e2metros extras enviados ao SISP.</p>"},{"location":"api/#geracao-do-formulario","title":"\ud83d\udcdd Gera\u00e7\u00e3o do Formul\u00e1rio","text":""},{"location":"api/#createpaymentform","title":"createPaymentForm","text":"<pre><code>createPaymentForm(string $responseUrl)\n</code></pre> <p>Gera HTML com auto-submit para o endpoint do SISP.</p>"},{"location":"api/#processar-resposta","title":"\ud83d\udce5 Processar Resposta","text":""},{"location":"api/#processresponse","title":"processResponse","text":"<pre><code>processResponse(array $post)\n</code></pre> <p>Retorna um array normalizado contendo:</p> <pre><code>[\n    'success' =&gt; bool,\n    'status'  =&gt; 'SUCCESS|ERROR|CANCELLED|INVALID_FINGERPRINT',\n    'message' =&gt; string,\n    'data'    =&gt; array,\n    'dcc'     =&gt; array|null,\n    'debug'   =&gt; array,\n]\n</code></pre>"},{"location":"api/#codigos-de-status-retornados","title":"\ud83e\udde9 C\u00f3digos de status retornados","text":"C\u00f3digo Significado SUCCESS Pagamento conclu\u00eddo ERROR Falha gen\u00e9rica CANCELLED Utilizador cancelou INVALID_FINGERPRINT Potencial fraude / manipula\u00e7\u00e3o"},{"location":"api/#notas-importantes","title":"\ud83d\udcc4 Notas Importantes","text":"<ul> <li>amount deve ser inteiro</li> <li>timezone do servidor deve estar correta</li> <li>fingerprints s\u00e3o obrigat\u00f3rios</li> <li>nunca reutilize a mesma inst\u00e2ncia para m\u00faltiplos pagamentos</li> </ul>"},{"location":"api/#continue-lendo","title":"\ud83d\udcda Continue lendo","text":"<ul> <li>Guia R\u00e1pido</li> <li>Documenta\u00e7\u00e3o Avan\u00e7ada</li> </ul>"},{"location":"examples/","title":"Exemplos de Integra\u00e7\u00e3o","text":"<p>Este guia apresenta exemplos pr\u00e1ticos, completos e prontos para uso para todas as opera\u00e7\u00f5es suportadas pelo SDK:</p> <ul> <li>\u2714\ufe0f Purchase (Compra 3D Secure)</li> <li>\u2714\ufe0f Pagamento de Servi\u00e7o</li> <li>\u2714\ufe0f Recarga</li> <li>\u2714\ufe0f Refund (Reembolso)</li> <li>\u2714\ufe0f Processamento de Callback (retorno do SISP)</li> </ul> <p>Em todos os exemplos assumimos:</p> <pre><code>require_once \"Vinti4NetLegacy.php\";\n\n$posID       = \"POS123\";\n$posAuthCode = \"ABCDEF123456789\";\n$endpoint    = \"https://mc.vinti4net.cv/BizMPIOnUsSisp/CardPayment\";\n\n$vinti4 = new Vinti4NetLegacy($posID, $posAuthCode, $endpoint);\n</code></pre>"},{"location":"examples/#1-exemplo-purchase-compra-3d-secure","title":"\ud83d\udfe6 1. Exemplo \u2014 Purchase (Compra 3D Secure)","text":"<pre><code>require_once \"Vinti4NetLegacy.php\";\n\n$vinti4 = new Vinti4NetLegacy(\"POS123\", \"ABCDEF123456789\");\n\n// Prepara cobran\u00e7a 3D Secure\n$vinti4-&gt;preparePurchasePayment(\n    1500, // valor em escudos\n    [\n        'email' =&gt; 'cliente@example.com',\n        'billAddrCountry' =&gt; '132',\n        'billAddrCity' =&gt; 'Praia',\n        'billAddrLine1' =&gt; 'Avenida Cidade Lisboa',\n        'billAddrPostCode' =&gt; '7600',\n        'mobilePhone' =&gt; '+23899123456',\n    ]\n);\n\n// Cria formul\u00e1rio HTML de pagamento\necho $vinti4-&gt;createPaymentForm(\n    \"https://seusite.com/callback\",\n    \"PEDIDO-123\"\n);\n</code></pre> <p>\u27a1 O formul\u00e1rio gerado ser\u00e1 auto\u2010submetido ao SISP.</p>"},{"location":"examples/#2-exemplo-pagamento-de-servico","title":"\ud83d\udfe6 2. Exemplo \u2014 Pagamento de Servi\u00e7o","text":"<pre><code>require_once \"Vinti4NetLegacy.php\";\n\n$vinti4 = new Vinti4NetLegacy(\"POS123\", \"ABCDEF123456789\");\n\n$vinti4-&gt;prepareServicePayment(\n    2500,     // valor\n    123,      // c\u00f3digo da entidade\n    4567890   // refer\u00eancia\n);\n\necho $vinti4-&gt;createPaymentForm(\n    \"https://seusite.com/callback\",\n    \"SERVICO-555\"\n);\n</code></pre>"},{"location":"examples/#3-exemplo-recarga","title":"\ud83d\udfe6 3. Exemplo \u2014 Recarga","text":"<pre><code>require_once \"Vinti4NetLegacy.php\";\n\n$vinti4 = new Vinti4NetLegacy(\"POS123\", \"ABCDEF123456789\");\n\n$vinti4-&gt;prepareRechargePayment(\n    500,      // valor\n    220,      // entidade\n    990123456 // refer\u00eancia de recarga\n);\n\necho $vinti4-&gt;createPaymentForm(\n    \"https://seusite.com/callback\",\n    \"RECARGA-001\"\n);\n</code></pre>"},{"location":"examples/#4-exemplo-refund-estorno","title":"\ud83d\udfe6 4. Exemplo \u2014 Refund (Estorno)","text":"<pre><code>require_once \"Vinti4NetLegacy.php\";\n\n$vinti4 = new Vinti4NetLegacy(\"POS123\", \"ABCDEF123456789\");\n\n$vinti4-&gt;prepareRefundPayment(\n    1500,              // valor original\n    \"PEDIDO-123\",      // merchantRef original\n    \"SESSAO-123\",      // session original\n    \"TID987654321\",    // ID da transa\u00e7\u00e3o original\n    202401             // clearingPeriod recebido na compra\n);\n\necho $vinti4-&gt;createPaymentForm(\n    \"https://seusite.com/callback-refund\",\n    \"REFUND-01\"\n);\n</code></pre>"},{"location":"examples/#5-exemplo-callback-processamento-do-retorno-sisp-seu-servidor","title":"\ud83d\udfe6 5. Exemplo \u2014 Callback / Processamento do Retorno (SISP \u2192 Seu servidor)","text":"<p>Este script deve estar na URL que voc\u00ea configurou em:</p> <pre><code>$vinti4-&gt;createPaymentForm(\"https://seusite.com/callback\");\n</code></pre> <p>Crie por exemplo: callback.php</p> <pre><code>require_once \"Vinti4NetLegacy.php\";\n\n$posID       = \"POS123\";\n$posAuthCode = \"ABCDEF123456789\";\n\n$vinti4 = new Vinti4NetLegacy($posID, $posAuthCode);\n\n// Recebe POST do gateway\n$response = $vinti4-&gt;processResponse($_POST);\n\n// Log opcional\nfile_put_contents(\"callback.log\", print_r($response, true), FILE_APPEND);\n\nif ($response['status'] === 'SUCCESS') {\n    echo \"Pagamento bem-sucedido. TID: \" . $response['data']['merchantRespTid'];\n    exit;\n}\n\nif ($response['status'] === 'CANCELLED') {\n    echo \"O utilizador cancelou o pagamento.\";\n    exit;\n}\n\nif ($response['status'] === 'INVALID_FINGERPRINT') {\n    echo \"Aviso: fingerprint inv\u00e1lido \u2014 pode indicar adultera\u00e7\u00e3o dos dados!\";\n    exit;\n}\n\necho \"Falha no pagamento: \" . $response['message'];\n</code></pre>"},{"location":"examples/#extras-uteis","title":"\ud83d\udccc Extras \u00fateis","text":""},{"location":"examples/#acesso-a-dados-dcc-se-disponiveis","title":"\ud83d\udd39 Acesso a dados DCC (se dispon\u00edveis)","text":"<pre><code>if (!empty($response['dcc']) &amp;&amp; $response['dcc']['enabled']) {\n    echo \"Valor em moeda estrangeira: \" . $response['dcc']['amount'];\n    echo \"Moeda: \" . $response['dcc']['currency'];\n    echo \"Taxa: \" . $response['dcc']['rate'];\n}\n</code></pre>"},{"location":"examples/#estrutura-completa-retornada-em-response","title":"\ud83d\udd39 Estrutura completa retornada em <code>$response</code>","text":"<pre><code>print_r($response);\n/*\n[\n  'status' =&gt; 'SUCCESS',\n  'message' =&gt; 'Transa\u00e7\u00e3o v\u00e1lida.',\n  'success' =&gt; true,\n  'data' =&gt; [...],\n  'dcc' =&gt; [...],\n  'debug' =&gt; [],\n  'detail' =&gt; null\n]\n*/\n</code></pre>"},{"location":"laravel/","title":"Exemplos de Integra\u00e7\u00e3o Laravel \u2014 Vinti4Net Legacy PHP SDK","text":"<p>Assumimos Laravel 8+ ou 9+.</p> <p>\u26a0\ufe0f Aten\u00e7\u00e3o: Este SDK Legacy funciona em Laravel e PHP 5.6+, mas n\u00e3o \u00e9 recomendado para projetos modernos. Para Laravel e PHP 8.1+, \u00e9 melhor usar o erilshk/vinti4net, que \u00e9 mais moderno, mant\u00e9m compatibilidade total e oferece recursos atualizados para integra\u00e7\u00e3o com o SISP/Vinti4Net.</p>"},{"location":"laravel/#1-instalacao","title":"1. Instala\u00e7\u00e3o","text":"<p>Via Composer, instale o SDK:</p> <pre><code>composer require erilshk/vinti4net-legacy\n</code></pre> <p>Opcional: voc\u00ea pode criar um provider ou facade, mas neste exemplo usamos diretamente a classe.</p>"},{"location":"laravel/#2-configuracao","title":"2. Configura\u00e7\u00e3o","text":"<p>Crie um arquivo de configura\u00e7\u00e3o <code>config/vinti4net.php</code>:</p> <pre><code>&lt;?php\n\nreturn [\n    'pos_id' =&gt; env('VINTI4NET_POS_ID', 'POS123'),\n    'pos_auth_code' =&gt; env('VINTI4NET_POS_AUTH', 'ABCDEF123456789'),\n    'endpoint' =&gt; env('VINTI4NET_ENDPOINT', 'https://mc.vinti4net.cv/BizMPIOnUsSisp/CardPayment'),\n];\n</code></pre> <p>No <code>.env</code>:</p> <pre><code>VINTI4NET_POS_ID=POS123\nVINTI4NET_POS_AUTH=ABCDEF123456789\nVINTI4NET_ENDPOINT=https://mc.vinti4net.cv/BizMPIOnUsSisp/CardPayment\n</code></pre>"},{"location":"laravel/#3-controller-base","title":"3. Controller Base","text":"<p>Crie <code>app/Http/Controllers/Vinti4NetController.php</code>:</p> <pre><code>&lt;?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse Vinti4NetLegacy;\n\nclass Vinti4NetController extends Controller\n{\n    protected $vinti4;\n\n    public function __construct()\n    {\n        $this-&gt;vinti4 = new Vinti4NetLegacy(\n            config('vinti4net.pos_id'),\n            config('vinti4net.pos_auth_code'),\n            config('vinti4net.endpoint')\n        );\n    }\n}\n</code></pre>"},{"location":"laravel/#4-purchase-3d-secure","title":"4. Purchase (3D Secure)","text":"<pre><code>public function purchase()\n{\n    $html = $this-&gt;vinti4\n        -&gt;preparePurchasePayment(1500, [\n            'email' =&gt; 'cliente@example.com',\n            'billAddrCountry' =&gt; '132',\n            'billAddrCity' =&gt; 'Praia',\n            'billAddrLine1' =&gt; 'Rua Cidade Nova',\n            'billAddrPostCode' =&gt; '7600',\n            'mobilePhone' =&gt; '+23899123456',\n        ])\n        -&gt;createPaymentForm(route('vinti4net.callback'), 'PEDIDO-123');\n\n    return response($html);\n}\n</code></pre> <p><code>route('vinti4net.callback')</code> deve apontar para o callback abaixo.</p>"},{"location":"laravel/#5-service-payment","title":"5. Service Payment","text":"<pre><code>public function servicePayment()\n{\n    $html = $this-&gt;vinti4\n        -&gt;prepareServicePayment(2500, 123, 456789)\n        -&gt;createPaymentForm(route('vinti4net.callback'), 'SERVICO-555');\n\n    return response($html);\n}\n</code></pre>"},{"location":"laravel/#6-recharge","title":"6. Recharge","text":"<pre><code>public function recharge()\n{\n    $html = $this-&gt;vinti4\n        -&gt;prepareRechargePayment(500, 220, 990123456)\n        -&gt;createPaymentForm(route('vinti4net.callback'), 'RECARGA-001');\n\n    return response($html);\n}\n</code></pre>"},{"location":"laravel/#7-refund-estorno","title":"7. Refund (Estorno)","text":"<pre><code>public function refund()\n{\n    $html = $this-&gt;vinti4\n        -&gt;prepareRefundPayment(\n            1500,\n            'PEDIDO-123',\n            'SESSAO-123',\n            'TID987654321',\n            202401\n        )\n        -&gt;createPaymentForm(route('vinti4net.callback'), 'REFUND-01');\n\n    return response($html);\n}\n</code></pre>"},{"location":"laravel/#8-callback-processamento-de-retorno","title":"8. Callback / Processamento de Retorno","text":"<pre><code>public function callback(Request $request)\n{\n    $response = $this-&gt;vinti4-&gt;processResponse($request-&gt;post());\n\n    // Log para debug\n    \\Log::info('Vinti4Net Callback', $response);\n\n    switch ($response['status']) {\n        case 'SUCCESS':\n            return \"Pagamento conclu\u00eddo! TID: \" . $response['data']['merchantRespTid'];\n        case 'CANCELLED':\n            return \"O utilizador cancelou a transa\u00e7\u00e3o.\";\n        case 'INVALID_FINGERPRINT':\n            return \"Aten\u00e7\u00e3o: fingerprint inv\u00e1lido!\";\n        default:\n            return \"Falha no pagamento: \" . $response['message'];\n    }\n}\n</code></pre> <p>N\u00e3o se esque\u00e7a de adicionar a rota:</p> <pre><code>use App\\Http\\Controllers\\Vinti4NetController;\n\nRoute::post('/vinti4net/callback', [Vinti4NetController::class, 'callback'])-&gt;name('vinti4net.callback');\n</code></pre>"},{"location":"laravel/#9-dicas-extras","title":"9. Dicas extras","text":"<ul> <li>Para ambiente de teste, use o endpoint fornecido pelo SISP.</li> <li>Sempre logar o callback antes de processar.</li> <li>Recomenda-se armazenar <code>merchantRef</code> e <code>merchantSession</code> no banco para rastreio.</li> <li>Se usar DCC, voc\u00ea pode acessar <code>$response['dcc']</code>.</li> </ul>"},{"location":"quickstart/","title":"Guia R\u00e1pido","text":"<p>Este guia mostra como integrar rapidamente um fluxo de pagamento usando o Vinti4Net Legacy PHP SDK.</p>"},{"location":"quickstart/#1-instalacao","title":"1. Instala\u00e7\u00e3o","text":"<p>Via Composer:</p> <pre><code>composer require erilshk/vinti4net-legacy\n</code></pre> <p>Ou incluindo manualmente:</p> <pre><code>require 'Vinti4NetLegacy.php';\n</code></pre>"},{"location":"quickstart/#2-criando-uma-instancia","title":"2. Criando uma inst\u00e2ncia","text":"<pre><code>require 'Vinti4NetLegacy.php';\n\n$vinti4 = new Vinti4NetLegacy(\n    'POS123',          // POS ID\n    'ABCDEF123456'     // POS Auth Code\n);\n</code></pre>"},{"location":"quickstart/#3-pagamento-rapido-purchase-3ds","title":"3. Pagamento r\u00e1pido (Purchase 3DS)","text":"<pre><code>$html = $vinti4\n    -&gt;preparePurchasePayment(1500, [\n        'user' =&gt; [\n            'email' =&gt; 'cliente@example.com',\n            'country' =&gt; '132',\n            'city' =&gt; 'Praia',\n            'address' =&gt; 'Achada S. Ant\u00f3nio',\n            'postCode' =&gt; '7600'\n        ]\n    ])\n    -&gt;createPaymentForm('https://seusite.cv/retorno');\n\necho $html;\n</code></pre> <p>Isso ir\u00e1 gerar automaticamente um formul\u00e1rio HTML com auto-submit para o SISP.</p>"},{"location":"quickstart/#4-processando-o-retorno","title":"4. Processando o retorno","text":"<p>No seu endpoint de retorno:</p> <pre><code>$response = $vinti4-&gt;processResponse($_POST);\n\nif ($response['success']) {\n    echo \"Pagamento conclu\u00eddo com sucesso!\";\n} else {\n    echo \"Falhou: \" . $response['message'];\n}\n</code></pre>"},{"location":"quickstart/#5-outros-fluxos-suportados","title":"5. Outros fluxos suportados","text":""},{"location":"quickstart/#pagamento-de-servicos","title":"Pagamento de Servi\u00e7os","text":"<pre><code>$vinti4-&gt;prepareServicePayment(2300, '999', '123456789');\n</code></pre>"},{"location":"quickstart/#recargas","title":"Recargas","text":"<pre><code>$vinti4-&gt;prepareRechargePayment(500, '9012345');\n</code></pre>"},{"location":"quickstart/#refund","title":"Refund","text":"<pre><code>$vinti4-&gt;prepareRefundPayment(1500, $merchantRef, $merchantSession, $transactionID, $clearingPeriod);\n</code></pre> <p>esses parametros, normalmente voc\u00ea deve ter salvo na Base de dados. Elas v\u00eam no POST de resposta do SISP</p>"},{"location":"quickstart/#6-proximos-passos","title":"6. Pr\u00f3ximos passos","text":"<ul> <li>Leia a Documenta\u00e7\u00e3o Avan\u00e7ada</li> <li>Veja todos os m\u00e9todos na API Reference</li> <li>Consulte exemplos completos</li> </ul>"}]}